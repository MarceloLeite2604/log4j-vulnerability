# LOG4J Vulnerability

A Java-based project presenting how to exploit [CVE-2021-44228](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-44228) vulnerability.

### Requirements
- A Linux-based operating system: I used [Ubuntu Desktop 20.10 64 bits](https://ubuntu.com/download/desktop)
- [OpenJDK 17.0.1](https://jdk.java.net/17/): To build the exploitation program. Newer versions might work as well.
- Oracle Java Development Kit (JDK) 1.8.0_181: This is _essential_ for the exploitation to work. **It is not necessary to have it installed**, but the project needs it extracted on the root directory. The JDK can be found on [Oracle Java SE 8 Archive Downloads (JDK 8u202 and earlier) page](https://www.oracle.com/br/java/technologies/javase/javase8-archive-downloads.html).
- [Apache Maven 3.6.3](https://maven.apache.org/download.cgi): To manage dependencies and generate jar files. Later versions might work as well.
- [Docker 20.10.12](https://docs.docker.com/engine/install/ubuntu/): To manage the container which contains the service to be exploited. Later versions might work as well.
- [Docker-compose 1.29.2](https://docs.docker.com/compose/install/): To help orchestrate the image generation as well as the container creation, execution and removal. Later versions might work as well.
- [GNU Make 4.3](https://www.gnu.org/software/make/): This project uses Makefile to help verify and generate mandatory files. Later versions might work as well.
- [OpenBSD Netcat (aka nc)](https://linux.die.net/man/1/nc): To create the communication with the invaded server. This package can be install through your Linux distribution package manager (like apt).
- (Recommended) [IntelliJ IDEA Community Edition 2021.3.1](https://www.jetbrains.com/idea/download/download-thanks.html?platform=linux&code=IIC): If you want to check what is under the hood of these projects then I recommend installing this IDE. Once again, later versions might work as well.

### Execution
1. Clone this repository into our local machine.
1. Download [Oracle Java SE 8 Archive Downloads (JDK 8u202 and earlier) page](https://www.oracle.com/br/java/technologies/javase/javase8-archive-downloads.html) and extract it on the project root directory. Keep it under the `jdk1.8.0_181` directory created during the extraction.
1. Run `make all` to build all projects and create a Docker image with the vulnerable service.
1. Open three terminals and run the following commands:
    1. First terminal: `make start-vulnerable-service` to start a Docker container running the service to be exploited. The service will accessible through [local machine port 8080](http://localhost:8080)
    1. Second terminal: `make start-nc` to start a TCP lister which will wait for the connection with the invaded server to be stablished.
    1. Third terminal: `make start-exploiter` to start the program which will help us exploit the vulneability.
1. After starting the third terminal, exploiter program will present an URL to access. Paste it on your browser to start the exploitation.
1. If everything happened as expected, the browser will not receive a response and the page be stuck in a loading status.
1. Now check the second terminal (the one where `make start-nc` has been executed). You might have received a message like `Connection received on 172.24.0.2 46638` (IP address and TCP port might not be the same as presented here). This means that the exploitation worked and we now have a shell connected on the server/Docker container.
1. To be sure if everything occurred as expected, try to execute a `whoami` command. You might receive `root` as output.
1. Now try to run `cat ../private-directory/my-secret-file.txt` to see what happens. :)
1. Once you have finished messing up with the server, press `CTRL+C` to close the connection.
1. You can also press `CTRL+C` on the other terminals to interrupt the processes.

### References

[kozmer/log4j-shell-poc Github project](https://github.com/kozmer/log4j-shell-poc) - It helped me understand how the exploitation works. Thank you all who contributed to this project!

[mbechler/marchalsec Github project](https://github.com/mbechler/marshalsec) - I would not be able to work with LDAP communication and redirection as quickly as I did without this project. Thank you folks!

[SrcCodes Log4j Vulnerability video](https://youtu.be/ziZnU3t-DRM) - A well explained video presenting how to start the exploitation on a Spring-based program.

[Nowcomm CVE-2021-44228 exploit demo video](https://youtu.be/t_WPuzrXxVs) - A nice video explaining how to exploit CVE-2021-44228 on Apache Solr. I had to watch the second half about a dozen times to understand what was actually happening! :P